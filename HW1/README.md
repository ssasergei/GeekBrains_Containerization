# Семинар 1. Практика. Контейнеры

# Задачи 1 семинара

## Задание 0, проверочное:
Проверьте работоспособность ОС, выполнив набор команд, .представленных на лекции:/
> mkdir testfolder (если testfolder уже есть, создайте свою новую папку)\
>mkdir testfolder/bin\
>cp /bin/bash testfolder/bin\
>ldd /bin/bash\
>mkdir testfolder/lib\
>mkdir testfolder/lib64\
>cp /lib/x86_64-linux-gnu/libtinfo.so.6 testfolder/lib\
>cp /lib/x86_64-linux-gnu/libc.so.6 testfolder/lib\
>cp /lib64/ld-linux-x86-64.so.2 testfolder/lib64/\
>chroot testfolder\

![0](https://github.com/ssasergei/GeekBrains_Containerization/blob/master/HW1/screenshots/task0.jpg)
## Задание 1:

> Продолжаем работу в командной строке. В частности - в той же папке.\
> Добавьте в измененный корень команду, которая могла бы отображать путь к папке - команда ls. Вместе с зависимостями, чтобы она запускалась внутри “измененного корня”.\
> Добавьте набор команд для вывода “корня”, чтобы убедиться, что вы действительно изолировали среду.

![1](https://github.com/ssasergei/GeekBrains_Containerization/blob/master/HW1/screenshots/task1.jpg)

## Задание 2:

Воспользуйтесь командой:
>ls -l /proc/$$/ns

Что мы видим? У нас есть уже некоторые созданные пространства имен. 

>lrwxrwxrwx 1 root root 0 Nov 16 11:50 cgroup -> 'cgroup:[4026531835]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 ipc -> 'ipc:[4026531839]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 mnt -> 'mnt:[4026531841]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 net -> 'net:[4026531840]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 pid -> 'pid:[4026531836]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 pid_for_children -> 'pid:[4026531836]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 time -> 'time:[4026531834]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 time_for_children -> 'time:[4026531834]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 user -> 'user:[4026531837]'\
>lrwxrwxrwx 1 root root 0 Nov 16 11:50 uts -> 'uts:[4026531838]'\

Как можно видеть, наша сессия принадлежит ряду групп. Об этом и свидетельствует вывод консоли. Напомню ряд важных пространств имен:
>net - сеть\
>pid - разграничение процессов\
>	user - маппинг юзеров\
>uts - позволяет менять hostname\

**Все пространства имен можно просмотреть командой lsns:**

Собственно, теперь вы обладаете достаточной информацией для того, чтобы запустить приложение изолированно. Какое приложение вы бы запустили изолированно и почему? 

**Ответ довольно прост:** командную оболочку. Экранировав процесс, можно запускать дочерние с теми же параметрами. Командная оболочка как нельзя лучше подходит.

И чтобы выполнить такое экранирование, в разных пространствах имен, текущей изоляции с использованием chroot недостаточно. Воспользуемся командой unshare, встроенной утилитой, которая позволит нам выполнить изолирование процессов в различных пространствах имен для утилиты bash. 

Утилита unshare имеет ряд флагов, доступных для выполнения. Полную инструкцию по использованию вам необходимо запросить, вызвав man unshare, но основные хотелось бы также озвучить:
--pid
--net
--fork
--mount-proc
Каждый из флагов соответствует пространству имен, которые вы ранее видели выше.

## Сама задача:

>Создайте новое сетевое пространство имен и изолируйте его. Используйте команду unshare и необходимые флаги. И убедитесь, что это получилось, проверив командой ip a

*спойлер: вам будет нужно самостоятельно прочитать информацию о команде, прописав следующие команды в терминале:*

- unshare
- man unshare
- unshare --help

> программу, которую вам надо запустить в некотором namespace - bash

![2](https://github.com/ssasergei/GeekBrains_Containerization/blob/master/HW1/screenshots/task2.jpg)

## Задание 3:

> После выполнения задачи выше попробуйте выполнить изоляцию процессов, файловой системы и сети(которая создастся при использовании unshare и нужного флага с нуля), используя команду unshare и необходимые флаги. И убедитесь, что это получилось, проверив командой ps -aux (Вы должны увидеть после изоляции пространства имен процессов  ограниченный список процессов, а не все процессы системы).

![3](https://github.com/ssasergei/GeekBrains_Containerization/blob/master/HW1/screenshots/task3.jpg)